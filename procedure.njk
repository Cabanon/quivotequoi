---
pagination:
    data: procedures
    size: 1
    alias: procedure
permalink: "procedure/{{ procedure.reference }}/index.html"
---
{% import "components.njk" as c %}
{% extends "parent.njk" %}
{% block main %}
<a href="/">â—€ï¸ Retourner Ã  la recherche</a>
<h2>{{ procedure.title }}</h2>
{% set docs = docs | where('procedure', procedure.reference) %}
{% set doc_refs = docs | map('ref') %}
{% set procedure_votes = votes | where_in('doc', doc_refs) %}
{% set primary_votes = procedure_votes | where_in('type', ['ADOPTION', 'REJECTION']) %}
<h3>ğŸ¯ Votes principaux</h3>
{% for primary in primary_votes | reverse %}
    <article>
    <header>{% if primary.type == 'ADOPTION' %}ğŸ‘ Adoption du texte{% else %}ğŸ‘ Rejet du texte{% endif %} | {{ c.adopted(primary.result) }}</header>
    {% if primary.votes %}
        <h6>ğŸ‡ªğŸ‡º Votes de tous les dÃ©putÃ©s europÃ©ens</h6>
        <section>{{ c.simplebar(primary.votes) }}</section>
        <details>
            <summary>ğŸ“Š Voir la lÃ©gende</summary>
            <ul>
                <li>ğŸŸ¢ Pour</li>
                <li>ğŸ”´ Contre</li>
                <li>ğŸŸ¡ Abstention</li>
                {# <li>âšª Absence</li> #}
            </ul>
        </details>
        <hr>
        <h6>ğŸ‡«ğŸ‡· Votes des dÃ©putÃ©s franÃ§ais</h6>
        {% set finals = votings | where('procedure_ref', procedure.reference ) | where('type', primary.type) %}
        {% if finals.length == 1 %}
            <section>{{ c.fullbar(finals[0].positions) }}</section>
            <a href="/voting/{{ finals[0].id }}">ğŸ—³ Voir le dÃ©tail du vote</a>
        {% else %}
            ğŸ” Vote introuvable
        {% endif %}
    {% else %}
        ğŸ– Vote Ã  main levÃ©e
    {% endif %}
    </article>
{% endfor %}
<h3>ğŸ· Sujets</h3>
<ul>
    {{ procedure.subject }}
    {% for code in procedure.subjects %}
        {% set subject = subjects | find('code', code) %}
        {% if subject %}
            <li>{{ subject.name }}</li>
        {% else %}
            <li>{{ code }}</li>
        {% endif %}
    {% endfor %}
</ul>
{% set amd_votes = procedure_votes | where ('type', 'AMENDMENT') | intsort('amendment') %}
<h3>ğŸ““ Amendements</h3>
{% for vote in amd_votes %}
    {% set amendment = docs | find('ref', vote.doc) | map('amendments') | find('nr', vote.amendment) %}
    {% if amendment %}
    <article>
    <header>ğŸ“ Amendement nÂ°{{ vote.amendment }}{% if vote.split %} | Partie {{ vote.split }}{% endif %} | {{ c.adopted(vote.result) }}</header>
    {% if vote.split %}
        <p>ğŸ”œ Vote par division : aperÃ§u bientÃ´t disponible</p>
    {% else %}
        {{ c.amendment(amendment) }}
    {% endif %}
    <footer>
        {% if vote.votes %}
            {{ c.simplebar(vote.votes, true) }}
            {% if vote.rcv %}
                {% set vote_votings = votings | where('doc', vote.doc ) | where('amendment', vote.amendment) %}
                {% if vote.split %}
                    {% set voting = vote_votings | where('split', vote.split) | first %}
                {% else %}
                    {% set voting = vote_votings | first %}
                {% endif %}
                <a href="/voting/{{ voting.id }}">ğŸ“£ Vote nominal : voir le dÃ©tail</a>
            {% else %}
                ğŸ¤– Vote Ã©lectronique
            {% endif %}
        {% else %}
            ğŸ– Vote Ã  main levÃ©e
        {% endif %}
    </footer>
    </article>
    {% endif %}
{% else %}
    Aucun amendement
{% endfor %}
<h3>Sources</h3>
<ul>
  <li><a href="{{ procedure.url | replace('.json', '.do') }}" target="_blank">â„¹ï¸ ProcÃ©dure</a></li>
  {% for doc in docs %}
    <li><a href="{{ doc.url }}" target="_blank">ğŸ“œ Texte et amendements</a></li>
  {% endfor %}
  {% for url in procedure_votes | map('url') | uniq %}
    <li><a href="{{ url | replace('.xml', '.html') }}" target="_blank">ğŸ—³ DÃ©tails des votes </a></li>
  {% endfor %}
</ul>
{% endblock %}